name: PR Checks

on:
  pull_request:
    branches:
      - main
      - master
      - develop
    paths-ignore:
      - '**.md'
      - 'LICENSE'
  push:
    branches:
      - main
      - master
      - develop

permissions:
  contents: read
  checks: write
  pull-requests: write

# Cancel in-progress runs of the same workflow for the same branch
concurrency:
  group: ${{ github.workflow }}-${{ github.ref }}
  cancel-in-progress: true

jobs:
  build:
    name: Build & Compile
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout code
      uses: actions/checkout@v4
      
    - name: Set up JDK 11
      uses: actions/setup-java@v4
      with:
        java-version: '11'
        distribution: 'temurin'
        cache: maven
        
    - name: Compile code
      run: mvn clean compile
      
    - name: Package
      run: mvn package -DskipTests
      
    - name: Upload artifact
      uses: actions/upload-artifact@v4
      with:
        name: jar-package
        path: target/*.jar
        retention-days: 1
  
  # Call unit tests workflow
  unit-tests:
    name: Unit Tests
    needs: build
    uses: ./.github/workflows/unit-tests.yml
    permissions:
      contents: read
      checks: write
      pull-requests: write
  
  # Call integration tests workflow
  integration-tests:
    name: Integration Tests
    needs: build
    uses: ./.github/workflows/integration-tests.yml
    permissions:
      contents: read
      checks: write
      pull-requests: write
  
  code-quality:
    name: Code Quality Checks
    needs: build
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout code
      uses: actions/checkout@v4
      
    - name: Set up JDK 11
      uses: actions/setup-java@v4
      with:
        java-version: '11'
        distribution: 'temurin'
        cache: maven
        
    - name: Check for compilation warnings
      run: mvn compile -Xlint:deprecation -Xlint:unchecked
      continue-on-error: true
      
    - name: Verify project structure
      run: mvn verify -DskipTests
